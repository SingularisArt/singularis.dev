{{- $pages := .Site.Pages -}}
{{- $excludedPath := "content/content.md" -}}
{{- $excludedPath := "layouts/_default/search.json" -}}
{{- $jsonPages := slice -}}
{{- range $pages -}}
  {{- if and (ne .Permalink $excludedPath) (not .Params.draft) -}}
    {{- $jsonPages = $jsonPages | append . -}}
  {{- end -}}
{{- end -}}
[
  {{- $first := true -}}
  {{- range $index, $page := $jsonPages -}}
    {{- if not $first -}},{{- end -}}
    {{- $path := $page.Permalink | relURL -}}
    {{- $type := index (split $path "/") 1 -}}
    {
      "id": {{ $index }},
      "title": "{{ $page.Title | plainify }}",
      "content": "{{ $page.Plain | plainify }}",
      "summary": "{{ $page.Summary | plainify }}",
      "date": "{{ $page.Date.Format "January 2 Monday, 2006" }}",
      "type": "{{ $type }}",
      "url": "{{ $path }}"
    }
    {{- $first = false -}}
  {{- end -}}
]
